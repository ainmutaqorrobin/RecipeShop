import{S as g,d,e as s,g as n,j as c,k as p,m as l,sa as k}from"./chunk-5MNRTRAW.js";var o=class{constructor(r,T,e,t){this.email=r,this.id=T,this._token=e,this._tokenExpirationDate=t}get token(){return!this._tokenExpirationDate||this._tokenExpirationDate<new Date?null:this._token}};var u={production:!1,firebaseAPIKey:"AIzaSyDvp1vw0srS2tA6YT6YFxLL2GyqpDrdpDo"};var _=(()=>{let r=class r{constructor(e,t){this.http=e,this.router=t,this.user=new d(null),this.tokenExpiredTiming=null}signup(e,t){return this.http.post("https://identitytoolkit.googleapis.com/v1/accounts:signUp?key="+u.firebaseAPIKey,{email:e,password:t,returnSecureToken:!0}).pipe(n(this.handleError),c(i=>{this.handleUser(i.email,i.localId,i.idToken,+i.expiresIn)}))}login(e,t){return this.http.post("https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key="+u.firebaseAPIKey,{email:e,password:t,returnSecureToken:!0}).pipe(n(this.handleError),c(i=>{this.handleUser(i.email,i.localId,i.idToken,+i.expiresIn)}))}autoLogin(){let e=JSON.parse(localStorage.getItem("userData"));if(!e)return;let t=new o(e.email,e.id,e._token,new Date(e._tokenExpirationDate));if(t.token){this.user.next(t);let i=new Date(e._tokenExpirationDate).getTime()-new Date().getTime();this.autoLogout(i)}}logout(){this.user.next(null),this.router.navigate(["/signup"]),localStorage.removeItem("userData"),this.tokenExpiredTiming&&clearTimeout(this.tokenExpiredTiming),this.tokenExpiredTiming=null}autoLogout(e){console.log(e),this.tokenExpiredTiming=setTimeout(()=>{this.logout()},e)}handleUser(e,t,i,h){let f=new Date(new Date().getTime()+h*1e3),m=new o(e,t,i,f);this.user.next(m),this.autoLogout(h*1e3),localStorage.setItem("userData",JSON.stringify(m))}handleError(e){console.log(e);let t="Unknown error occured!";if(!e||!e.error||!e.error.error)return s(()=>t);switch(e.error.error.message){case"EMAIL_EXISTS":t="This email is already exist.";break;case"EMAIL_NOT_FOUND":t="This email does not exist.";break;case"INVALID_LOGIN_CREDENTIALS":t="This password is not correct.";break;case"INVALID_CUSTOM_TOKEN":t="The custom token format is incorrect or the token is invalid for some reason.";break;case"CREDENTIAL_MISMATCH":t="The custom token corresponds to a different Firebase project.";break;case"INVALID_EMAIL":t="The email address is badly formatted.";break;case"TOO_MANY_ATTEMPTS_TRY_LATER : Access to this account has been temporarily disabled due to many failed login attempts. You can immediately restore it by resetting your password or you can try again later.":t="We have blocked all requests from this device due to unusual activity. Try again later.";break;case"USER_DISABLED":t="This account has been disabled.";break}return s(()=>t)}};r.\u0275fac=function(t){return new(t||r)(l(g),l(k))},r.\u0275prov=p({token:r,factory:r.\u0275fac});let a=r;return a})();export{_ as a};
